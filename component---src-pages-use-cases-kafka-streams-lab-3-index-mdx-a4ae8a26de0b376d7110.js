(window.webpackJsonp=window.webpackJsonp||[]).push([[116,73,123],{"013z":function(e,t,a){"use strict";var n=a("q1tI"),r=a.n(n),s=a("NmYn"),o=a.n(s),i=a("Wbzz"),c=a("Xrax"),b=a("k4MR"),l=a("TSYQ"),p=a.n(l),m=a("QH2O"),u=a.n(m),d=a("qKvR"),g=function(e){var t,a=e.title,n=e.theme,r=e.tabs,s=void 0===r?[]:r;return Object(d.b)("div",{className:p()(u.a.pageHeader,(t={},t[u.a.withTabs]=s.length,t[u.a.darkMode]="dark"===n,t))},Object(d.b)("div",{className:"bx--grid"},Object(d.b)("div",{className:"bx--row"},Object(d.b)("div",{className:"bx--col-lg-12"},Object(d.b)("h1",{id:"page-title",className:u.a.text},a)))))},h=a("BAC9"),f=function(e){var t=e.relativePagePath,a=e.repository,n=Object(i.useStaticQuery)("1364590287").site.siteMetadata.repository,r=a||n,s=r.baseUrl,o=r.subDirectory,c=s+"/edit/"+r.branch+o+"/src/pages"+t;return s?Object(d.b)("div",{className:"bx--row "+h.row},Object(d.b)("div",{className:"bx--col"},Object(d.b)("a",{className:h.link,href:c},"Edit this page on GitHub"))):null},A=a("FCXl"),O=a("dI71"),y=a("I8xM"),v=function(e){function t(){return e.apply(this,arguments)||this}return Object(O.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,n=e.slug,r=n.split("/").filter(Boolean).slice(-1)[0],s=a.map((function(e){var t,a=o()(e,{lower:!0,strict:!0}),s=a===r,c=new RegExp(r+"/?(#.*)?$"),b=n.replace(c,a);return Object(d.b)("li",{key:e,className:p()((t={},t[y.selectedItem]=s,t),y.listItem)},Object(d.b)(i.Link,{className:y.link,to:""+b},e))}));return Object(d.b)("div",{className:y.tabsContainer},Object(d.b)("div",{className:"bx--grid"},Object(d.b)("div",{className:"bx--row"},Object(d.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(d.b)("nav",{"aria-label":t},Object(d.b)("ul",{className:y.list},s))))))},t}(r.a.Component),j=a("MjG9"),k=a("CzIb"),w=a("Asxa"),N=a("OIbQ"),S=a.n(N),T=function(e){var t=e.date,a=new Date(t);return t?Object(d.b)(w.c,{className:S.a.row},Object(d.b)(w.a,null,Object(d.b)("div",{className:S.a.text},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,a=e.children,n=e.location,r=e.Title,s=t.frontmatter,l=void 0===s?{}:s,p=t.relativePagePath,m=t.titleType,u=l.tabs,h=l.title,O=l.theme,y=l.description,w=l.keywords,N=l.date,S=Object(k.a)().interiorTheme,C=Object(i.useStaticQuery)("2456312558").site.pathPrefix,I=C?n.pathname.replace(C,""):n.pathname,R=u?I.split("/").filter(Boolean).slice(-1)[0]||o()(u[0],{lower:!0}):"",x=O||S;return Object(d.b)(b.a,{tabs:u,homepage:!1,theme:x,pageTitle:h,pageDescription:y,pageKeywords:w,titleType:m},Object(d.b)(g,{title:r?Object(d.b)(r,null):h,label:"label",tabs:u,theme:x}),u&&Object(d.b)(v,{title:h,slug:I,tabs:u,currentTab:R}),Object(d.b)(j.a,{padded:!0},a,Object(d.b)(f,{relativePagePath:p}),Object(d.b)(T,{date:N})),Object(d.b)(A.a,{pageContext:t,location:n,slug:I,tabs:u,currentTab:R}),Object(d.b)(c.a,null))}},BAC9:function(e,t,a){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,a){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},"M+yy":function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return d}));var n=a("wx14"),r=a("zLVn"),s=(a("q1tI"),a("7ljp")),o=a("013z"),i=(a("qKvR"),{}),c=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",t)}},b=c("InlineNotification"),l=c("AnchorLinks"),p=c("AnchorLink"),m={_frontmatter:i},u=o.a;function d(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(s.b)(u,Object(n.a)({},m,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)(b,{kind:"warning",mdxType:"InlineNotification"},Object(s.b)("strong",null,"Work in progress")," Updated 06/09/2021"),Object(s.b)(l,{mdxType:"AnchorLinks"},Object(s.b)(p,{mdxType:"AnchorLink"},"Overview"),Object(s.b)(p,{mdxType:"AnchorLink"},"Pre-requisites"),Object(s.b)(p,{mdxType:"AnchorLink"},"One Click Deploy to OpenShift"),Object(s.b)(p,{mdxType:"AnchorLink"},"Testing the solution"),Object(s.b)(p,{mdxType:"AnchorLink"},"Understanding the Kafka Streams implementation"),Object(s.b)(p,{mdxType:"AnchorLink"},"Interactive queries"),Object(s.b)(p,{mdxType:"AnchorLink"},"Event Streams on Cloud as Kafka provider")),Object(s.b)("h2",null,"Overview"),Object(s.b)("p",null,"In this lab, we’re going to use ",Object(s.b)("a",{parentName:"p",href:"https://quarkus.io"},"Quarkus")," to develop the near real-time inventory logic using Kafka Streams APIs and microprofile reactive messaging."),Object(s.b)("p",null,"The requirements to address are:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"consume item sold events from the ",Object(s.b)("inlineCode",{parentName:"li"},"items")," topic. Item has SKU as unique key. Item event has store ID reference"),Object(s.b)("li",{parentName:"ul"},"the Kafka record in the ",Object(s.b)("inlineCode",{parentName:"li"},"items")," topic, uses the Store unique ID as key"),Object(s.b)("li",{parentName:"ul"},"compute for each item its current stock cross stores"),Object(s.b)("li",{parentName:"ul"},"compute the store’s stock for each item"),Object(s.b)("li",{parentName:"ul"},"generate inventory event for store - item - stock"),Object(s.b)("li",{parentName:"ul"},"expose APIs to get stock for a store or for an item")),Object(s.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"280px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"188.92857142857144%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAmCAIAAABLWSz8AAAACXBIWXMAAAsTAAALEwEAmpwYAAADyElEQVRIx51VS2wbVRQdSCLUUkJgR9dIsGIFCyrYsIQdlYA4zceFBewoQqJCpSqLSq1ESys1ILXLpiqCKmqFVKBVywJRRFBJUuz4N/5lxr+xPZ6PPT/Pu7d3xrE7SZPY5mg8euOZM+d+ztzHIaJq4N0ISiotEfARACC4Dl52wBk2vnManvsIDhwHSaXbwBj0sOXpS3dgZh5mv4Pr/3i3uL+S8PxhNvc9jM/hwl3NMWpStU6o1WqyLDs+bMdFR1u4Ux+ZwtEp9uQkPDMHURE508G3T8PeWXj9K9iIvKvXarWI32g05Iaqy+K5xQI3iU/PuntmXHrF/QxyCI6s2TfvO6WGuznNQPL+mQF++SMeOIFvfI3nf/VzVlQ1HotWRD4aeUAy29apC1Ytr4tisVAoWGbTI/M8v7q6ms2tR6NRQRBwJ3U/nVxe4Pl0MsVresuvtmFIUpWyqjcamq5t6daWyG3bia7FxUKxo8FtfveOYIzRA2WRr4iJihBvaXVPmX63H3itW1yCYKm3Vb54ywydVafP69f/tj1yVsL9n8CLn8K+ObgXM6Hd0nXqEZ09tHzoTcMx5Ku/18amcewQPBHCiQ8hXkBuNQ/Pht03T7C9s+znJQPbuqLqzWZTUZRsNkt8jaC3TLV05prX54lwezzMRkOwxPthz9/GV47iyRubIiSQzzqV7+TitPHIZXj1GL52DE/d8O1pWZZSL5EZVbnC3DY913M1/cm6Ru8UTFXkQrFcq9cRXI9M1ReEgrCepwaSjYNF6in3mi+K4tpaJM2nLMveqPZOeJxMPk+n07lcznXdDXIwsG3JPWYmk4nFYolEghYU5qDKvr1sKnyjCxIfgtxpBATa0YfMAmOlm9ejNwyk3JM6dxPePQsHv4Wrf+5M7nDy+TzxyWqyohlq+cJijow5GvLG0J4Z+G99V+VKpWKaJtXJtBxkzYu/yNx7+NQhd2yKjYTg3+yAYftxuwyP/4RvnfSOC7/h0CbRlGqpKNSqZYT20ORCqRyJRFOptGk7Q5OpBLFYnBw+UJ+D9qRLMnYimYzHE7SgQg7hsHbbpWlpGZpjtWg+/B972q539A+bhkGwVbQlTs/Dy5/BS0fgiyv9HCZJkhenZRmmja76zbUKmWTiMBsPA/c+3EvuqkxfLHlTVVVF1QxNWrgl7gvjyKTLfcBe+Bj48q7kx+c2bcufX8GjP+Af8X45b9pD6NukWEytIiTVutgpxMDKnXlab8TiqXQmb7fd/spB0DCg5tGuSjOMHDIouTfGl5eXi8UiTc+VlRXahh4C4do/dTDBlkYAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"0",title:"0",src:"/refarch-eda/static/4207f369eb1cca1d6a96a2598170ea07/485fa/inventory-use-cases.png",srcSet:["/refarch-eda/static/4207f369eb1cca1d6a96a2598170ea07/485fa/inventory-use-cases.png 280w"],sizes:"(max-width: 280px) 100vw, 280px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(s.b)("p",null,"The solution is using Kafka Streams and it includes two services. The components used are:"),Object(s.b)("p",null," ",Object(s.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"979px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"56.25%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz31SPW8UQQzdXwwdHfwDGipEkwKJoJOgQJACGgpOJOikKFISEQiJkov4SPbC7t7M2GOPbTx7ORBCYna1evL4PdvP23ztLc6/L9t26LrQ98pspfzv9QRVG09zd1I+nQQz8YDW8M3Fv0dWd86XmixizfWiZYQ+attlzsKokIXYgCSzOqDyt8ZIvqlMlCVjO5QUZXo2e3Lw0sYW6ndswvmrc95aQK/oYrJY2sHcmqqVc+Yq9mG+N9nfchAobR5tLbBz7PVXFW9v4M5xBS47+yL3X9CaTFpECTKnzMQ/Q/do9vTbcPmb7GMen19FcLfEHxNU6ipZKTP7qJqAcrGIriZxoGUg75nHmdUZKmMlMuPdU3n4Riu56xFrqLiw11ctbhJX4J5Vd/poJz80uagbGbP3cXFF00Oo5PYa3+4Nr3eTu3OxsOfb1aLTS5tM0cQxbX9MtzaouLIUAFrvWRsZd/fsPTx4BQ52juDOY1dJ7w7Tvc1g4kHrA3w+a1f218F0vee6DCyF0AoiFARQTWGJGUEEUsy+Ss6eQL4SZzL++cN+AS5KdzwBMEcbAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"1",title:"1",src:"/refarch-eda/static/51b88483a278e01ac0601f0edf77edca/539c8/inventory-components.png",srcSet:["/refarch-eda/static/51b88483a278e01ac0601f0edf77edca/7fc1e/inventory-components.png 288w","/refarch-eda/static/51b88483a278e01ac0601f0edf77edca/a5df1/inventory-components.png 576w","/refarch-eda/static/51b88483a278e01ac0601f0edf77edca/539c8/inventory-components.png 979w"],sizes:"(max-width: 979px) 100vw, 979px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(s.b)("p",null,"The goal of this lab, is to develop the green components which expose APIs to support Kafka Streams interactive query on top of the aggregates to keep\nthe inventory views and saved in state store (light blue storage/per service deployed and persisted in Kafka as topic)."),Object(s.b)("p",null,"We will be unit testing the stream logic using ",Object(s.b)("a",{parentName:"p",href:"https://kafka.apache.org/documentation/streams/"},"Apache Kafka Streams")," TopologyTestDriver class. "),Object(s.b)("p",null,"This solution is deployed to OpenShift cluster with Strimzi running in the same cluster and namespace."),Object(s.b)("p",null,"This application needs the ",Object(s.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-store-simulator"},"Item Store sell simulator")," to perform the end to end\ntesting and to demonstrate the end to end scenario."),Object(s.b)("h2",null,"Pre-requisites"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"Access to an ",Object(s.b)("strong",{parentName:"p"},"OpenShift Container Platform")," v4.6.x")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"Kafka"),": The lab can use Event Streams on Cloud or Kafka Strimzi deployed on OpenShift.")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"Code Source"),": from the git repositories: "),Object(s.b)("ul",{parentName:"li"},Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory"},"https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory")," to compute item inventory cross store"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory"},"https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory")," to compute store inventory."),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/eda-lab-inventory"},"https://github.com/ibm-cloud-architecture/eda-lab-inventory")," to get access to deployment configuration to deploy on OpenShift.")),Object(s.b)("pre",{parentName:"li"},Object(s.b)("code",{parentName:"pre",className:"language-sh"},"git clone https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory\ngit clone https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory\ngit clone https://github.com/ibm-cloud-architecture/eda-lab-inventory\n"))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"OC CLI")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"As in previous labs, be connected to your Openshift cluster."))),Object(s.b)("p",null,"We have automated the deployment of all the pieces making up this use case. We are using the open source Strimzi operator to get a Kafka cluster deployed"),Object(s.b)("h3",null,"IBM OpenLabs"),Object(s.b)("p",null,"In this section, we are going to see use the ",Object(s.b)("a",{parentName:"p",href:"https://developer.ibm.com/openlabs/openshift"},"IBM OpenLabs")," hosted environment."),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"Go to ",Object(s.b)("a",{parentName:"p",href:"https://developer.ibm.com/openlabs/openshift"},"IBM OpenLabs")," in a browser and click on ",Object(s.b)("inlineCode",{parentName:"p"},"Launch Lab")," button for ",Object(s.b)("strong",{parentName:"p"},"Bring Your Own Application"),"."),Object(s.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"98.61111111111111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAErklEQVQ4y12T+1OUVRjHXwmXezUtd1wBRVlIUREWEHZXAUVuAe6yK7sLlgiKeQHFyBqnZip1Grtp0y/OVPZDVpY2lojlpMBMakkz/QVOILd2V2B3gU2YPp33RXDsnfnO85znnPN9v8/lSElJSSQkJBAVFUVkZKRio6OjFRsTE6P485DXMuLi4khOTiZas5To2NiFvfj4eKT8/HyKi4vR6XTo9XoKCgrIy8sjKysLg8GgXJYvyHbJkiUkJiYqSBKENo2aamMBFdXVGI1GZV+SnYqKCtLT00lLS0Or1bJy5UpSU1MVKyuRM5D/rtFokDNatmwZySkplCTGUmnIp7KmhrLSUlJETAoMDCQgIICgoKDHCA5GpVIpCH7ky3HZDw0NJTwsTMFToWGoQkIIEXF5Pzw8HMlkMlFbW4vZbF6A1WLBZrNjs9upq6vD4XBgF76jvl7xbQ0NOARe3LFDnLNhEeetVqtyVhofH2dqaorJyUkePnxI/8AAJ0+9z5FDrRw6uJ+zZ8/S3t5OR0cHRw4f4ovPPud4axtvHT3KnpY99PX1IX/T09P4/X6k4eFh7t+/z4AgGhkZweVy0nm9mxWr89nX9hqdV64QER7B2lWraN65k493t/BzRBQ60ahFgRKXL32nEMrCvF4vksfjQYa8kFVOTIxxVRA2vnqa0+d+4PbtW1TXbKNRkB0/cZJvz5yhp9JE49ZSikqK6O3tYXZmVtybmCOUSWTMEzrdbv4aHMDndePzuPF6JhgSql1jbvzToiyzoiyTXnz+aUXZv7Mzyl2fz6dAcrlcyPB65wJegRvdd7jQ2cP5H29y4WoPV7pucvFaL19e/kXEu7nW1c3Frh7OXfqJzpt3FgQpCuUaDg4OivqNMipqOPK3k81VTSQaHKhWVfF0pomMfDPLi15CSi0jdE016/S1LN+8E0mziYzKvfwjmuHxPCKUG9Lf36/g3r17DA4Nk2frIGK9VaCW6A12EoubUOfaBWzE5jtILtmNOscmflBOtrlVEE7jmVc4OjrK0NAQTqdT6bDL/YBcUxMqrYGgtEKey6piRZGVp9cUs1i7iUhdDUkGk7KWUvTkmvcq47JAKI+KnLKcukzqdrvQNXzAorzjSDkfoS56m8TyY6gMp5B0H6IufIOl5W+y2PAe0pp30e34BP+UVxD65gjn50ceHbkpY2Mumt65zsZDt9G3/UbZ4e+pOXKJolfuUtB6h9K2bzAf7WJrx+9kv9zLrhPXmZ70KE1VCOfbPTc2Ph6MT2Da3szqLduJyalAo7dg3GIhs6Ie9fpSEvRW7NZG0jeUE5BqpNDR+mTK8+1WCBWF4+RY2wnPtBCQXiVsLUsLG5UmLUp7gQixXrG5iWeyxbtdXkbWtoNiPqceE86rWyAUCjdYDxCyuhRVeglqnZnkTQ7CMspYnDa31my0E76uUjSliCzzfvwzM49r+AShnPLYGMaG1wnNFnO2di/Rxn1oy1qIyG1GythDvLGF5wt3EZXVSLC2gVL7MfzOEbzinvwo/kc4xdgDJxsPXCXScgv19j9Iqfsarf0r4ux3edbaR4blU7bWnyfTcYvU6hs0H7yA/89f8Y4KUvFi/gNRXOXLH4d14AAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"OpenLabs1",title:"OpenLabs1",src:"/refarch-eda/static/577163a595685babd678b64d02632e8e/3cbba/openLabs1.png",srcSet:["/refarch-eda/static/577163a595685babd678b64d02632e8e/7fc1e/openLabs1.png 288w","/refarch-eda/static/577163a595685babd678b64d02632e8e/a5df1/openLabs1.png 576w","/refarch-eda/static/577163a595685babd678b64d02632e8e/3cbba/openLabs1.png 1152w","/refarch-eda/static/577163a595685babd678b64d02632e8e/0b124/openLabs1.png 1728w","/refarch-eda/static/577163a595685babd678b64d02632e8e/4ea69/openLabs1.png 2304w","/refarch-eda/static/577163a595685babd678b64d02632e8e/a4b11/openLabs1.png 2560w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"Sign in with your IBM Cloud account or register for an IBM Cloud account."),Object(s.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"39.583333333333336%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABj0lEQVQoz3WR20pCQRSG92N0gsrKEgtKzbKCMshSKw9Z6o1gUVRU1KWvUs/hhZddexUUQdAJqSzLvdV9NvffzFgbiVrwsWYWrG/WzHDdoyH8R68jjDabH3OruxAqVej1OlRNQ53kJjp0XYOqqtBIncLRpt6xMGs2+d5bnFG02wPwhvbB8zw0WUC1UsbrWwlvpXdGpVploh8pR5sszohJnytq0j++hg57EIuxA1zeFnGavcb5RQGKLBFRDbWaCFmWiUhlQgrX51pDkyjLrVemh3WNrBDhIe6eysjmX3D1KIBGo9GAQaBX13XdhBtwx5hoJrgDX+wIsXQGC0SwvpnB7OoeOoeXWV2WRMCQoSoiXksfKJMnKAsCkxiGYcJZJ9Zh88Th8KbgmE9hLrSHaf82PEtbcPvSbNJA/BiFIo9c/gHPJQGKIqMmipAkiawVfJIpaTDh0OQGhohwkORWrO7mQT1jEawkT3BT4HGWu0eRV/BXmBPaphKwTcXRzAkmYZC1fTrJ3nGJTEh/8HdzKz/1L/m9v4CbKsJtAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"OpenLabs2",title:"OpenLabs2",src:"/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/3cbba/openLabs2.png",srcSet:["/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/7fc1e/openLabs2.png 288w","/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/a5df1/openLabs2.png 576w","/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/3cbba/openLabs2.png 1152w","/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/0b124/openLabs2.png 1728w","/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/4ea69/openLabs2.png 2304w","/refarch-eda/static/5b05967bffee19c540a8cb682a0477f3/2dd9a/openLabs2.png 2558w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"You will be presented with a dialog asking you whether you have an ",Object(s.b)("strong",{parentName:"p"},"Opportunity Id")," or not.\nIf you don’t have it or don’t no, just select ",Object(s.b)("strong",{parentName:"p"},"No")," and click on ",Object(s.b)("strong",{parentName:"p"},"Launch Lab"),".")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"You should now see your IBM OpenLabs environment."),Object(s.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"50.69444444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVQoz32Sy07CUBCGeQvCfUVbFvAGbFibCpLIEh9MoyACvo4rH8CACb2X3lt+Z462AURP8ud0pu03/5w5pcenGZ4XC9w/PGA2n2O5XAq9kES8Wgmt168ink7vcDuZYDgaCV0PR7hSh1BVFTfjMUqaZsDzPOTrcACy7IAkTXG+oijCYDBAr9eDoihCsqxAkmXaZbTbbQLudtB1Ha7rwjBMmKYJh55tx6HcHg7tlmUL2Hb7iW63i2aziVarhXq9fqJarYaSbdtgsUvTtKBpegE2LUvkGB7FMTabDSRJQqVSQaPRuKiSRT+xGMg/pWmGJEloT5FmGbX/HfPaUTfcWrVa/RvI7hjo+z6dXyZAYRgKWEIFfHrPhRjMR8PASw655cJh3vLb+wc0w0YchSJ2+fwMGhoViwmaAy85LIDHDv0gJncRgiAQw2C5e0/E/znMYTysE2C+2I3j8LBcmnRY5PlbvirHwBzGEy6Xy+cOA2rVx55cOXRlOMfXJf45Q558p9P55ZBhXKjf7+ML/wg3DVOtlLgAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"OpenLabs4",title:"OpenLabs4",src:"/refarch-eda/static/f2e3793327798bf936817b28710c2a26/3cbba/openLabs4.png",srcSet:["/refarch-eda/static/f2e3793327798bf936817b28710c2a26/7fc1e/openLabs4.png 288w","/refarch-eda/static/f2e3793327798bf936817b28710c2a26/a5df1/openLabs4.png 576w","/refarch-eda/static/f2e3793327798bf936817b28710c2a26/3cbba/openLabs4.png 1152w","/refarch-eda/static/f2e3793327798bf936817b28710c2a26/0b124/openLabs4.png 1728w","/refarch-eda/static/f2e3793327798bf936817b28710c2a26/4ea69/openLabs4.png 2304w","/refarch-eda/static/f2e3793327798bf936817b28710c2a26/28e48/openLabs4.png 5120w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"On the left hand side navigation menu, click on the ",Object(s.b)("strong",{parentName:"p"},"Quick Links and Common Commands")," section.\nNow, if you scroll down on the instructions shown on your screen, you should reach the ",Object(s.b)("strong",{parentName:"p"},"Commonly Used Commands"),"\nsection of these and in there you should see an ",Object(s.b)("inlineCode",{parentName:"p"},"oc login ...")," command to get your terminal associated to this\nIBM OpenLabs logged into the OpenShift cluster that you will be working with for this quickstart tutorial.\nClick on the ",Object(s.b)("inlineCode",{parentName:"p"},"oc login...")," command and you should see a ",Object(s.b)("inlineCode",{parentName:"p"},"Login successful")," message on the terminal."),Object(s.b)("p",{parentName:"li"},"  ",Object(s.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"66.66666666666666%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACpElEQVQ4y42S309SYRzG+Sdsgj8mhBJq/mitucWZW9ZFF40uRLO2RJ1gZnOmIMrRcRBXrbairatuuuqPMbWBMViJiaCHXyEHwXMQ8el9D1ldUWd79t33fc/7eZ/v3kfh4jhwbjc4zg33ygpcLg5OlsWi0wl2aUnec3F/xC4tY36Bhc3BYs7ugH1+nsgBm82O2dk5KERRRL5QwI9MBuXyGehXLBZxfCzK9aRUQvmssn56WsZDsxm379zF9d4+GJheMAwDg4FBX99NmAYGoAgEvyEQ+IJYLAZBEJBKpZFIJJA5PEQ+n0eBXEZF4fF4HD1dnWC6O9Cp16Gurg719fVoaGhAY2MjmpqaKDCMrS0/otEYkskU9g94RPd5Ak3KfSqdlt3TCw7I3i3GgBvXrqLnSjda29qg0+mg1Wqh0WjQ3NwMRTqdQpocoi4oNBQKIRj6ip2d7wRwILvieZ7Ak4hEIujs6oaGHFRrLsqO1Gq17I66pVJkyZjZbBZHuSM8e+FB/5ARQ/fvob/fBJOposHBQRiNRng8HrS3t+NCTY08KtXfY1MpKIwqR+T3+7G2tobNzU1sbGxgfX0dn4hopb3P50OrXg+lUvkbcK5zaAUo5HBULMH7zovhsQcYs4zAbB6BZdwCq8WKCesERkj/+o0Xlzs6UFtbWwVIYNlkAoXAZ3x8tYrlmUm4Z6fgnpvC88WnFS3MYNUxjQ8vV9B2SQelSlUNKFSAwS2855yYJg4dj0ZhnzDDZh3GwuQo2CfjcDwew1vWBn1LS3WgQEfO5SBIEqSTEsRjCaIoycGmVZJIuIsnoNmOxvahJS+sqgr89co5UmlMtre3EQ6Hsbu7S2IUlSND12lsgsGgnLX/AxKXhzS8BEDDzPNxGULX6T8SmWBvb++fwJ+7Ep8oOWY7wQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"OpenLabs8",title:"OpenLabs8",src:"/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/3cbba/openLabs8.png",srcSet:["/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/7fc1e/openLabs8.png 288w","/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/a5df1/openLabs8.png 576w","/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/3cbba/openLabs8.png 1152w","/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/0b124/openLabs8.png 1728w","/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/4ea69/openLabs8.png 2304w","/refarch-eda/static/cb2ec4b71ebbae05234f2c6e95b76bf6/6f5db/openLabs8.png 2564w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")))),Object(s.b)("h2",null,"One Click Deploy to OpenShift"),Object(s.b)("p",null,"The different components are deployed in the same namespace as the Kafka cluster, and use internal route to access Kafka bootstrap URL."),Object(s.b)("p",null,"The images for each of the components used are in the ",Object(s.b)("a",{parentName:"p",href:"https://quay.io/organization/ibmcase"},"quay.io ibmcase")," repository:"),Object(s.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"717px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"52.43055555555556%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz52QzU6DQBSFeSBXFF25cG1MLPZ5iAELXWhibXge3sAmXXTZuiraUhhgmGH4KUcgtkmbmqCTfDnJTHLmu1fq9XrYI8vyUe5RFOWES1wpMi5u7nB9+4CBeo9+X4WqqpA0TcNwOISu6zBNE5ZlYTQatRiG8StPho5H6xnWyyvexmNMJhPYtg1JCIHdrkRzOOcIw7CFUor/HMnbbtuioihACIHnefB9H0EQIM9zlGXZvjV5SnHmTprP55jNZkgSdvbHqqoO2QXpfTqF4zhgjWWeIfoZl8ZxU3NU2mnk5fID680GjCVgeYUoSZFyBpZmYKJAmhWd7VrDxWKB1coFrwuJALYxr+0iBFTgi3Csw9q83DWa3Qtd120N4wwgiQBLKGKWgfIcYZ28tuy6x0Ph3tCLWL1HAp+m+AwY/Fj8aeRvLPDFsie/HVoAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"quay images",title:"quay images",src:"/refarch-eda/static/c25d14259d3ae40aa698617335e7b106/b6372/quay-images.png",srcSet:["/refarch-eda/static/c25d14259d3ae40aa698617335e7b106/7fc1e/quay-images.png 288w","/refarch-eda/static/c25d14259d3ae40aa698617335e7b106/a5df1/quay-images.png 576w","/refarch-eda/static/c25d14259d3ae40aa698617335e7b106/b6372/quay-images.png 717w"],sizes:"(max-width: 717px) 100vw, 717px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},"Under the ",Object(s.b)("inlineCode",{parentName:"li"},"eda-lab-inventory")," folder open the ",Object(s.b)("inlineCode",{parentName:"li"},"scripts/env-strimzi.sh")," file to provide your own values or use our defined values:")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"KAFKA_CLUSTER_NAME")," which is the name you want to give to the Kafka cluster that will get deployed. It defaults to my-kafka and we highly recommend you to leave the default. Otherwise, you would need to modify some yaml deployment scripts…"),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"YOUR_PROJECT_NAME")," which is the name of the OpenShift project the one-click-deployment script will create for you to get all the components of this solution deployed into. It defaults to rt-inventory. ")),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"Execute the ",Object(s.b)("inlineCode",{parentName:"p"},"deployInventoryWithStrimzi.sh")," one-click-deployment script:"),Object(s.b)("pre",{parentName:"li"},Object(s.b)("code",{parentName:"pre",className:"language-sh"},"./scripts/deployInventoryWithStrimzi.sh --skip-login\n")),Object(s.b)("p",{parentName:"li"},"This script can be run multiple times, in case of failure, it should continue creating the needed resources and apps.")),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"After some time (can easily take up to more than 10 min) you should see the following message:"))),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-sh"},"********************\n** CONGRATULATIONS!! You have successfully deployed the realtime inventory use case. \n********************\n")),Object(s.b)("ol",null,Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"Verify the running pods"),Object(s.b)("pre",{parentName:"li"},Object(s.b)("code",{parentName:"pre",className:"language-sh"},"NAME                                        READY   STATUS    RESTARTS   AGE\nitem-aggregator-557db4c9c6-xds24            1/1     Running   0          8m47s\nmy-kafka-cruise-control-69dd479bf6-bmnt6    2/2     Running   0          10m\nmy-kafka-entity-operator-7d5f948d84-9knnn   3/3     Running   0          11m\nmy-kafka-kafka-0                            1/1     Running   0          12m\nmy-kafka-kafka-1                            1/1     Running   0          12m\nmy-kafka-kafka-2                            1/1     Running   0          12m\nmy-kafka-zookeeper-0                        1/1     Running   0          13m\nmy-kafka-zookeeper-1                        1/1     Running   0          13m\nmy-kafka-zookeeper-2                        1/1     Running   0          12m\nstore-aggregator-7df98556ff-rdhcw           1/1     Running   0          4m59s\nstore-simulator-56f8958498-44q9q            1/1     Running   0          9m30s\n"))),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"Get the different service endpoints:"),Object(s.b)("pre",{parentName:"li"},Object(s.b)("code",{parentName:"pre",className:"language-sh"},"oc get routes\n\nitem-aggregator            item-aggregator-rt-inventory.dte-ocp46-73awfj-915b3b336cabec458a7c7ec2aa7c625f-0000.us-east.containers.appdomain.cloud            \nmy-kafka-kafka-bootstrap   my-kafka-kafka-bootstrap-rt-inventory.dte-ocp46-73awfj-915b3b336cabec458a7c7ec2aa7c625f-0000.us-east.containers.appdomain.cloud   \nstore-aggregator           store-aggregator-rt-inventory.dte-ocp46-73awfj-915b3b336cabec458a7c7ec2aa7c625f-0000.us-east.containers.appdomain.cloud           \nstore-simulator            store-simulator-rt-inventory.dte-ocp46-73awfj-915b3b336cabec458a7c7ec2aa7c625f-0000.us-east.containers.appdomain.cloud \n"))),Object(s.b)("li",{parentName:"ol"},Object(s.b)("p",{parentName:"li"},"You can also access the OpenShift Console and go to the installed Operators and select Strimzi. In this operators you can use the cluster, the users and the topics:"),Object(s.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(s.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"71.875%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABxklEQVQ4y52SjZLUIBCEef8ntPTW89TL5pIsBMJPgCTtzKzo7npllU7VVIDAR08PqpaCFCO894j03fcdx3HI939SDXrBl36GDRnrusJaizVncDD4X1N9fOnw4fQCR6AQIlJK8uMWSKN3D7e43ae2bUMmRVxujAnL4ikXaGPgQyArAsw8i3JrnaRzi1jEe4yZ5Syvz7RPOefQ9z2GYUAhPzmaH+3me5+OP9av4+tcMbXrzgLlW29Bj6W18u7msnZNDrVvFce+ycZMTeHGsA07zWutMn4X9NOzx1Am7viqM1LesNZdFhnKFjCsqWT4+XyGtlr+c4wXg8mQn6liiYX2U8mpHni+FDy9JZwop6ViLQRf0506qYCa56P/5XWum4B8uib7qGI50LsKvdDielXEIO7crUL2lpX5uAhYLiiVQBmBYJyicAw7nqaCQrfxIQ5WwCW30tolWmt8f/sGfhkcLqx4nTx6HSSZoS7k4YmALlYpgQ8zcBxHATZ1DDT07rqxk3fagN0l3AMnUviZPLShkH8FcyAP81+Aw+sD8LdCtkCZdODTSCXajJlUzmGjjldYep/N/AZl0GhG8ZeDGzHMEZNNkpU8/AFEx0VLvHLCXQAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(s.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"strimzi topics",title:"strimzi topics",src:"/refarch-eda/static/be04aca4a02b12a5d5d7d31b5af82e0a/3cbba/strimzi-topics.png",srcSet:["/refarch-eda/static/be04aca4a02b12a5d5d7d31b5af82e0a/7fc1e/strimzi-topics.png 288w","/refarch-eda/static/be04aca4a02b12a5d5d7d31b5af82e0a/a5df1/strimzi-topics.png 576w","/refarch-eda/static/be04aca4a02b12a5d5d7d31b5af82e0a/3cbba/strimzi-topics.png 1152w","/refarch-eda/static/be04aca4a02b12a5d5d7d31b5af82e0a/0b124/strimzi-topics.png 1728w","/refarch-eda/static/be04aca4a02b12a5d5d7d31b5af82e0a/1043c/strimzi-topics.png 1904w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "))),Object(s.b)("h3",null,"Some explanations of this deployment script"),Object(s.b)("p",null,"The script performs the following steps:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Create a project if it does not exist"),Object(s.b)("li",{parentName:"ul"},"Create a service account for the solution and a role binding to cluster role views"),Object(s.b)("li",{parentName:"ul"},"Create Strimzi operator if it is not already there"),Object(s.b)("li",{parentName:"ul"},"Create a kafka cluster in the project with 3 brokers and zookeeper"),Object(s.b)("li",{parentName:"ul"},"Create scram and tls user"),Object(s.b)("li",{parentName:"ul"},"Create the topics for solution"),Object(s.b)("li",{parentName:"ul"},"Create one config map to define topics and broker boostrap shareable between apps"),Object(s.b)("li",{parentName:"ul"},"Deploy each microservices")),Object(s.b)("h2",null,"Testing the solution"),Object(s.b)("p",null,"We have moved the demonstration script to the ",Object(s.b)("a",{parentName:"p",href:"/refarch-eda/scenarios/realtime-inventory/#demonstration-script-for-the-solution"},"scenario chapter"),"."),Object(s.b)("h2",null,"Understanding the Kafka Streams implementation"),Object(s.b)("p",null,"The item and store aggregator code are based on the same code structure, reflecting the DDD onion architecture:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},"└── ibm\n    └── gse\n        └── eda\n            └── inventory\n                ├── app\n                │   └── ItemAggregatorApplication.java\n                ├── domain\n                │   ├── ItemInventory.java\n                │   ├── ItemProcessingAgent.java\n                │   └── ItemTransaction.java\n                └── infra\n                    ├── ItemTransactionDeserializer.java\n                    ├── ItemTransactionStream.java\n                    └── api\n                        ├── InventoryResource.java\n                        ├── ItemCountQueries.java\n                        └── dto\n                            ├── ItemCountQueryResult.java\n                            └── PipelineMetadata.java\n")),Object(s.b)("p",null,"The interesting class that supports the business logic is in ",Object(s.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory/blob/master/src/main/java/ibm/gse/eda/inventory/domain/ItemProcessingAgent.java"},"ItemProcessingAgent.java"),". "),Object(s.b)("p",null,"Basically the logic to compute the different stocks are in the ",Object(s.b)("inlineCode",{parentName:"p"},"processItemTransaction")," method, which builds a Kafla Stream topology"),Object(s.b)("p",null,"For the stock of items cross store computation the code looks like:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-java"},"@Produces\npublic Topology processItemTransaction(){\n    KStream<String,ItemTransaction> items = inItemsAsStream.getItemStreams();     \n    // process items and aggregate at the store level \n    KTable<String,ItemInventory> itemItemInventory = items\n        // use store name as key, which is what the item event is also using\n        .map((k,transaction) -> {\n            ItemInventory newRecord = new ItemInventory();\n            newRecord.updateStockQuantityFromTransaction(transaction.sku, transaction);\n            return  new KeyValue<String,ItemInventory>(newRecord.itemID,newRecord);\n        })\n        .groupByKey( Grouped.with(Serdes.String(),ItemInventory.itemInventorySerde)).\n        aggregate( () -> new ItemInventory(),\n            (itemID,newValue,currentValue) -> currentValue.updateStockQuantity(itemID,newValue.currentStock),\n            materializeAsStoreInventoryKafkaStore());\n    produceStoreInventoryToOutputStream(itemItemInventory);\n    return inItemsAsStream.run();\n}\n")),Object(s.b)("p",null,"while for the store the code is also in ",Object(s.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory/blob/main/src/main/java/ibm/gse/eda/stores/domain/ItemProcessingAgent.java"},"ItemProcessingAgent")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-java"},"public Topology processItemTransaction(){\n    KStream<String,ItemTransaction> items = inItemsAsStream.getItemStreams();     \n    // process items and aggregate at the store level \n    KTable<String,StoreInventory> storeItemInventory = items\n        // use store name as key, which is what the item event is also using\n        .groupByKey(ItemStream.buildGroupDefinitionType())\n        // update the current stock for this <store,item> pair\n        // change the value type\n        .aggregate(\n            () ->  new StoreInventory(), // initializer when there was no store in the table\n            (store , newItem, existingStoreInventory) \n                -> existingStoreInventory.updateStockQuantity(store,newItem), \n                materializeAsStoreInventoryKafkaStore());       \n    produceStoreInventoryToInventoryOutputStream(storeItemInventory);\n    return inItemsAsStream.run();\n\n")),Object(s.b)("p",null,"Each project includes a set of unit tests to validate the logic."),Object(s.b)("h2",null,"Integration tests"),Object(s.b)("p",null,"For running the integration test, we propose to copy the e2e folder from the solution repository and follow the ",Object(s.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory#end-to-end-testing"},"readme instructions section end-to-end-testing "),"."),Object(s.b)("h2",null,"Deploy to OpenShift"),Object(s.b)("p",null,"Be sure to have done ",Object(s.b)("a",{parentName:"p",href:"../../overview/pre-requisites#getting-tls-authentication-from-event-streams-on-openshift"},"the steps described here")," to get user credentials and server side certificate. "),Object(s.b)("p",null,"The deployment is done using Quarkus kubernetes plugin which generates DeploymentConfig and other kubernetes manifests.",Object(s.b)("br",{parentName:"p"}),"\n","Here are the interesting properties to set environment variables from secrets "),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-properties"},"%prod.quarkus.openshift.env-vars.KAFKA_USER.value=sandbox-rp-tls-cred\nquarkus.openshift.env-vars.SECURE_PROTOCOL.value=SSL\nquarkus.openshift.env-vars.SECURE_PROTOCOL.value=SASL_SSL\nquarkus.openshift.env-vars.KAFKA_BROKERS.value=sandbox-rp-kafka-bootstrap.eventstreams.svc:9093\nquarkus.openshift.env-vars.KAFKA_CERT_PATH.value=/deployments/certs/server/ca.p12\nquarkus.openshift.env-vars.KAFKA_PASSWORD.secret=sandbox-rp-tls-cred\nquarkus.openshift.env-vars.KAFKA_PASSWORD.value=user.password\nquarkus.openshift.env-vars.KAFKA_CERT_PWD.secret=sandbox-rp-cluster-ca-cert\nquarkus.openshift.env-vars.KAFKA_CERT_PWD.value=ca.password\nquarkus.openshift.env-vars.USER_CERT_PATH.value=/deployments/certs/user/user.p12\nquarkus.openshift.env-vars.USER_CERT_PWD.secret=sandbox-rp-tls-cred\nquarkus.openshift.env-vars.USER_CERT_PWD.value=user.password\n")),Object(s.b)("p",null,"And an extract of the expected generated openshift manifests from those configurations:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-yaml"},"    spec:\n      containers:\n      - env:\n        - name: KAFKA_CERT_PWD\n          valueFrom:\n            secretKeyRef:\n              key: ca.password\n              name: sandbox-rp-cluster-ca-cert\n        - name: USER_CERT_PATH\n          value: /deployments/certs/user/user.p12\n        - name: USER_CERT_PWD\n          valueFrom:\n            secretKeyRef:\n              key: user.password\n              name: sandbox-rp-tls-cred\n        - name: KAFKA_BROKERS\n          value: sandbox-rp-kafka-bootstrap.eventstreams.svc:9093\n        - name: KAFKA_CERT_PATH\n          value: /deployments/certs/server/ca.p12\n        - name: KAFKA_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              key: user.password\n              name: sandbox-rp-tls-cred\n        - name: SECURE_PROTOCOL\n          value: SASL_SSL\n")),Object(s.b)("p",null,"Finally the TLS certificated are mounted to the expected locations defined in the environment variables. The properties for that are:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},"quarkus.openshift.mounts.es-cert.path=/deployments/certs/server\nquarkus.openshift.secret-volumes.es-cert.secret-name=sandbox-rp-cluster-ca-cert\nquarkus.openshift.mounts.user-cert.path=/deployments/certs/user\nquarkus.openshift.secret-volumes.user-cert.secret-name=sandbox-rp-tls-cred\n")),Object(s.b)("p",null,"which generates:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},'        volumeMounts:\n        - mountPath: /deployments/certs/server\n          name: es-cert\n          readOnly: false\n          subPath: ""\n        - mountPath: /deployments/certs/user\n          name: user-cert\n          readOnly: false\n          subPath: ""\n')),Object(s.b)("h2",null,"Interactive queries"),Object(s.b)("p",null,"We already addressed the interactive queries concept in ",Object(s.b)("a",{parentName:"p",href:"/refarch-eda/technology/kafka-streams/#interactive-queries"},"the kafka stream technology summary article"),".\nEach of the store and item aggregator implements those queries via two classes:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/refarch-eda-item-inventory/blob/master/src/main/java/ibm/gse/eda/inventory/infra/api/ItemCountQueries.java"},"ItemCountQueries")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("a",{parentName:"li",href:"https://github.com/ibm-cloud-architecture/refarch-eda-store-inventory/blob/main/src/main/java/ibm/gse/eda/stores/infra/api/StoreInventoryQueries.java"},"StoreInventoryQueries"))),Object(s.b)("p",null,"The principles are the same:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Get the metadata about each “kafka store” supporting the stateful KTables which are keeping the aggregate per item or per store."),Object(s.b)("li",{parentName:"ul"},"Get the value of the aggregate for the given key, locally or remotely.")),Object(s.b)("h2",null,"Event Streams on Cloud as Kafka provider"),Object(s.b)("p",null,"To be completed."),Object(s.b)("h3",null,"Connect to Event Streams"),Object(s.b)("p",null,"We suppose you have created an Event Streams service instance on IBM Cloud. If not you can see some of ",Object(s.b)("a",{parentName:"p",href:"/refarch-eda/technology/event-streams/es-cloud/"},"our getting started tutorial")),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"Connect to the cluster with ",Object(s.b)("inlineCode",{parentName:"p"},"ibmcloud login -a ....")," than init a session to your cluster: ",Object(s.b)("inlineCode",{parentName:"p"},"ibmcloud es init"))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"Create the needed topics, following the instructions as described ","[in this note]","(../.. /overview/pre-requisites#creating-event-streams-topics) or using the following command:"),Object(s.b)("pre",{parentName:"li"},Object(s.b)("code",{parentName:"pre",className:"language-shell"},"cloudctl es topic-create --name items --partitions 3 --replication-factor 3\ncloudctl es topic-create --name item.inventory --partitions 1 --replication-factor 3\ncloudctl es topic-create --name store.inventory --partitions 1 --replication-factor 3\ncloudctl es topics\n"))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"To connect from the deployed application running on OpenShift to Event Streams on cloud we need to use different security settings:\nwe need to define a user with ",Object(s.b)("inlineCode",{parentName:"p"},"scram-sha-512")," password, as this is the mechanism for external to the cluster connection. ",Object(s.b)("a",{parentName:"p",href:"https://ibm.github.io/event-streams/getting-started/connecting/"},"See product documentation")," on how to do it, or use our ",Object(s.b)("a",{parentName:"p",href:"/refarch-eda/use-cases/overview/pre-requisites#get-shram-user"},"quick summary here"),".")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"Get Server TLS certificate into the ",Object(s.b)("inlineCode",{parentName:"p"},"certs")," folder. See our ",Object(s.b)("a",{parentName:"p",href:"/refarch-eda/use-cases/overview/pre-requisites#get-tls-server-public-certificate"},"quick summary here")),Object(s.b)("pre",{parentName:"li"},Object(s.b)("code",{parentName:"pre",className:"language-shell"},""))),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},"Modify the ",Object(s.b)("inlineCode",{parentName:"p"},"application.properties")," file to define the kafka connection properties. We need two type of definitions, one for the kafka admin client so the kafka streams can create topics to backup state stores, and one for kafka streams consumer and producer tasks:"))),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-properties"},'kafka.bootstrap.servers=${KAFKA_BROKERS}\nkafka.security.protocol=${SECURE_PROTOCOL}\nkafka.ssl.protocol=TLSv1.2\n%dev.kafka.sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required username\\=\\"${KAFKA_USER}\\" password\\=\\"${KAFKA_PASSWORD}\\";\n%dev.kafka.sasl.mechanism=SCRAM-SHA-512\nkafka.ssl.truststore.location=${KAFKA_CERT_PATH}\nkafka.ssl.truststore.password=${KAFKA_CERT_PWD}\nkafka.ssl.truststore.type=PKCS12\n%prod.kafka.ssl.keystore.location=${USER_CERT_PATH}\n%prod.kafka.ssl.keystore.password=${USER_CERT_PWD}\n%prod.kafka.ssl.keystore.type=PKCS12\n')),Object(s.b)("p",null,"The above settings take into account that when running locally (",Object(s.b)("inlineCode",{parentName:"p"},"%dev")," profile) we use the ",Object(s.b)("inlineCode",{parentName:"p"},"scram-sha")," mechanism to authenticate, and when we deploy on openshift, the ",Object(s.b)("inlineCode",{parentName:"p"},"%prod")," profile is used with TLS mutual authentication  (client certificate in keystore)."),Object(s.b)("p",null,"The same approach applies for Kafka Stream:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},'quarkus.kafka-streams.bootstrap-servers=${KAFKA_BROKERS}\nquarkus.kafka-streams.security.protocol=${SECURE_PROTOCOL}\nquarkus.kafka-streams.ssl.protocol=TLSv1.2\n%dev.quarkus.kafka-streams.sasl.mechanism=SCRAM-SHA-512\n%dev.quarkus.kafka-streams.sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required username\\=\\"${KAFKA_USER}\\" password\\=\\"${KAFKA_PASSWORD}\\";\nquarkus.kafka-streams.ssl.truststore.location=${KAFKA_CERT_PATH}\nquarkus.kafka-streams.ssl.truststore.password=${KAFKA_CERT_PWD}\nquarkus.kafka-streams.ssl.truststore.type=PKCS12\n# Only if TLS is used for authentication instead of scram\n%prod.quarkus.kafka-streams.ssl.keystore.location=${USER_CERT_PATH}\n%prod.quarkus.kafka-streams.ssl.keystore.password=${USER_CERT_PWD}\n%prod.quarkus.kafka-streams.ssl.keystore.type=PKCS12\n')),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Define a file, like ",Object(s.b)("inlineCode",{parentName:"li"},".env"),", to set environment variables, and modify the settings from your Event Streams configuration.")),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre"},"KAFKA_BROKERS=minimal-prod-kafka-bootstrap-eventstreams....containers.appdomain.cloud:443\nKAFKA_USER=\nKAFKA_PASSWORD=\nKAFKA_CERT_PATH=${PWD}/certs/es-cert.p12\nKAFKA_CERT_PWD=\nSECURE_PROTOCOL=SASL_SSL\n")))}d.isMDXComponent=!0},OIbQ:function(e,t,a){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,a){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}}}]);
//# sourceMappingURL=component---src-pages-use-cases-kafka-streams-lab-3-index-mdx-a4ae8a26de0b376d7110.js.map